(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a7a7bba"],{"1e1f":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-form",{attrs:{form:t.form,hideRequiredMark:!0}},[a("a-card",{staticStyle:{"padding-top":"12px"},attrs:{bordered:!1}},[a("PlacementSelect"),a("a-tabs",{staticClass:"mytabs",attrs:{tabBarStyle:{backgroundColor:"#F7F7F7",marginLeft:"16px",marginTop:"-12px"},defaultActiveKey:"1"},on:{change:t.callback}},[a("span",{attrs:{slot:"tabBarExtraContent"},slot:"tabBarExtraContent"}),a("a-tab-pane",{key:"1",staticStyle:{"margin-top":"8px"},attrs:{tab:"Waterfall"}},[a("a-row",{staticStyle:{height:"44px"},attrs:{type:"flex",justify:"start"}},[a("a-form-item",[a("RegionsSelect",{staticStyle:{"margin-top":"2px",width:"260px"},attrs:{size:"default"},on:{change:t.regoinsSelectedId}})],1),a("a-form-item",[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-button",{staticStyle:{"margin-right":"8px","margin-left":"8px"},attrs:{type:"primary",ghost:""},on:{click:t.listSearch}},[t._v("Apply")]),a("a-button",{attrs:{type:"primary",ghost:""},on:{click:t.resetSearch}},[t._v("Clear")])],1)]),a("a-form-item",{staticStyle:{position:"absolute",right:"0px"}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-button",{directives:[{name:"action",rawName:"v-action:edit",arg:"edit"}],attrs:{type:"primary",ghost:""},on:{click:function(e){return t.handleEdit()}}},[t._v("Add Segment")])],1)])],1),a("a-spin",{attrs:{spinning:t.fetching}},[a("div",{staticStyle:{background:"#FFFFFF"}},[a("a-table",{ref:"table",staticClass:"ant-card-table-default",attrs:{rowKey:"id",dataSource:t.list,expandedRowKeys:t.curExpandedRowKeys,columns:t.columns,scroll:{y:t.scroll},expandIconAsCell:!1,expandIconColumnIndex:-1,pagination:!1},on:{change:t.tableChange},scopedSlots:t._u([{key:"name",fn:function(t,e){return a("span",{},[a("span",{style:0===e.status?"opacity: 0.3;":null},[a("om-text",{attrs:{tooltip:!0,text:t}})],1)])}},{key:"autoOpt",fn:function(e,n){return a("span",{},[a("span",{style:0===n.status?"opacity: 0.3;":null},[t._v(" "+t._s(0===e?"Manual":"Auto")+" ")])])}},{key:"ruleInstanceSize",fn:function(e,n){return a("span",{},[a("span",{style:0===n.status?"opacity: 0.3;":null},[t._v(" "+t._s(e)+" ")])])}},{key:"priority",fn:function(e,n){return a("span",{},[a("span",{style:n.status>0?null:"opacity: 0.3;"},[n.status>0&&t.canEdit?a("editable-cell",{attrs:{text:n.priority||"--"},on:{change:function(e){return t.onCellChange(n,"priority",e)}}}):n.status>0&&!t.canEdit?a("span",[t._v(t._s(e))]):a("span",[t._v(t._s("--"))])],1)])}},{key:"status",fn:function(e,n){return a("span",{},[[t.canEdit?a("div",[a("a",{attrs:{herf:"#"},on:{click:function(e){return t.handleEdit(n)}}},[t._v("Edit")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{attrs:{herf:"#"},on:{click:function(e){return t.segmentStatusUpdate(n)}}},[t._v(t._s(0===e?"Enable":"Disable"))]),"ALL"!==n.name?a("a-divider",{attrs:{type:"vertical"}}):t._e(),"ALL"!==n.name?a("a-popconfirm",{attrs:{title:"Are you really sure？",okText:"Yes",cancelText:"No"},on:{confirm:function(e){return t.segmentDelete(n)}}},[a("a",{attrs:{herf:"#"}},[t._v("Remove")])]):t._e(),n.expandStatus?a("span",{staticStyle:{float:"right"},on:{click:function(e){return t.handleOpen(n)}}},[a("img",{attrs:{src:"/assets/up.svg"}})]):a("span",{staticStyle:{float:"right"},on:{click:function(e){return t.handleOpen(n)}}},[a("img",{attrs:{src:"/assets/down.svg"}})])],1):a("div",[a("a",{attrs:{herf:"#"},on:{click:function(e){return t.viewMediation(n)}}},[t._v("Details")])])]],2)}},{key:"expandedRowRender",fn:function(e,n){return a("a-table",{ref:n+"table",attrs:{rowKey:"id",columns:1===e.autoOpt?t.innerColumnsHidePri:t.innerColumns,dataSource:e.ruleInstances,pagination:!1},scopedSlots:t._u([{key:"id",fn:function(e,n){return a("span",{},[a("span",{style:n.priority>=0?null:"opacity: 0.3;"},[t._v(" "+t._s(e)+" ")])])}},{key:"className",fn:function(t,e){return a("span",{},[a("ad-network",{attrs:{className:t,id:e.adnId,status:e.priority>=0?1:0}})],1)}},{key:"instanceName",fn:function(e,n){return a("span",{},[a("span",{style:n.priority>=0?null:"opacity: 0.3;"},[t._v(" "+t._s(e)+" ")])])}},{key:"operation",fn:function(e,n){return a("span",{},[[a("div",[a("a",{attrs:{herf:"#"},on:{click:function(e){return t.instanceStatusUpdate(n)}}},[t._v(t._s(n.priority>=0?"Disable":"Enable"))])])]],2)}}])})}}])})],1)])],1),a("a-tab-pane",{key:"2",staticClass:"water-fall",staticStyle:{height:"600px"},attrs:{tab:"Settings",forceRender:""}},[a("a-card",{staticClass:"card-noline",staticStyle:{height:"270px",background:"#FFFFFF","margin-top":"8px"},attrs:{title:"Waterfall Settings",bordered:!1}},[a("om-form",{attrs:{label:"Batch Size",field:"batchSize",tip:"Batch Size"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["batchSize",{rules:[{required:!0,message:"Pool Size can not be empty."}]}],expression:"['batchSize', { rules: [{ required: true, message: 'Pool Size can not be empty.'}] }]"}],ref:"iap-min",staticStyle:{width:"100%"},attrs:{type:"number",min:1,max:5}})],1),a("om-form",{attrs:{label:"Preload Timeout(s)",field:"preloadTimeout",tip:"Preload Timeout(s)"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["preloadTimeout",{rules:[{required:!0,message:"Pool Size can not be empty."}]}],expression:"['preloadTimeout', { rules: [{ required: true, message: 'Pool Size can not be empty.'}] }]"}],ref:"iap-min",staticStyle:{width:"100%"},attrs:{type:"number",min:1,max:30}})],1),a("om-form",{attrs:{label:"Pool Size",field:"inventoryCount",tip:"Pool Size"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["inventoryCount",{rules:[{required:!0,message:"Pool Size can not be empty."}]}],expression:"['inventoryCount', { rules: [{ required: true, message: 'Pool Size can not be empty.'}] }]"}],ref:"iap-min",staticStyle:{width:"100%"},attrs:{type:"number",min:2,max:20}})],1)],1),a("a-card",{staticStyle:{"margin-top":"8px",background:"#FFFFFF"},attrs:{bordered:!1}},[a("span",{staticStyle:{color:"rgba(0, 0, 0, 0.85)","font-weight":"500","font-size":"16px"},attrs:{slot:"title"},slot:"title"},[t._v("Audience Segment Automation "),a("a-switch",{staticStyle:{"margin-left":"100px"},attrs:{disabled:"",checkedChildren:"√",unCheckedChildren:"X",defaultChecked:!1}}),t._v(" "),a("span",{staticStyle:{"font-weight":"300"}},[t._v("Disable")])],1)]),a("div",{staticClass:"button-div"},[a("a-button",{directives:[{name:"action",rawName:"v-action:edit",arg:"edit"}],staticStyle:{bottom:"-40px",width:"180px",left:"-9.5%"},attrs:{type:"primary"},on:{click:t.placementSave}},[t._v("Save")])],1)],1)],1)],1)],1)},i=[],s=(a("c975"),a("a15b"),a("a434"),a("b0c0"),a("b64b"),a("d3b7"),a("2909")),r=a("b85c"),c=a("86b9"),o=a("57a9"),l=a("d5d5"),d=a("283f"),p=a("abaa"),u=a("9c76"),m=a("9c7f"),h=a("d2fb"),f=a("88bc"),y=a.n(f),b=a("5880"),S={name:"Mediation",components:{RegionsSelect:o["a"],PlacementSelect:l["a"],OmForm:u["a"],AdNetwork:p["a"],OmText:h["a"],EditableCell:m["a"]},data:function(){return{labelCol:{lg:{span:8},sm:{span:8}},wrapperCol:{lg:{span:7},sm:{span:7}},form:this.$form.createForm(this),searchOption:{},adNetworkName:this.$route.params.name,adTypes:this.$route.params.adTypes,canEdit:this.$auth("mediation.edit"),curExpandedRowKeys:[],scroll:200,currentExpandedStatOpen:!1,id:this.$route.params.id,placementSelectOption:[],instanceSelectOption:[],data:[],list:[],regions:[],fetching:!1,sortOrder:"",columns:[{title:"Segment",dataIndex:"name",width:"20%",scopedSlots:{customRender:"name"}},{title:"Optimize Type",dataIndex:"autoOpt",width:"15%",scopedSlots:{customRender:"autoOpt"}},{title:"Priority",dataIndex:"priority",align:"center",width:"200px",scopedSlots:{customRender:"priority"}},{title:"Active Instances",dataIndex:"ruleInstanceSize",align:"center",width:"20%",scopedSlots:{customRender:"ruleInstanceSize"}},{title:"Operations",dataIndex:"status",scopedSlots:{customRender:"status"}}],innerColumns:[{title:"",dataIndex:"",width:"10%"},{title:"Ad Network",dataIndex:"className",width:"25%",key:"className",scopedSlots:{customRender:"className"}},{title:"Instance",dataIndex:"instanceName",width:"15%",key:"instanceName",scopedSlots:{customRender:"instanceName"}},{title:"Priority",dataIndex:"priority",align:"center",width:"20%",key:"priority",scopedSlots:{customRender:"priority"}},{title:"Operations",dataIndex:"operation",key:"operation",scopedSlots:{customRender:"operation"}}],innerColumnsHidePri:[{title:"",dataIndex:"",width:"10%"},{title:"Ad Network",dataIndex:"className",width:"30%",key:"className",scopedSlots:{customRender:"className"}},{title:"Instance",dataIndex:"instanceName",width:"30%",key:"instanceName",scopedSlots:{customRender:"instanceName"}},{title:"Operations",dataIndex:"operation",key:"operation",scopedSlots:{customRender:"operation"}}]}},computed:Object(b["mapState"])({searchApp:function(t){return t.publisher.searchApp},searchPlacement:function(t){return t.publisher.searchPlacement}}),watch:{searchPlacement:function(t){this.listSearch()},data:function(t){var e=this;this.list=[],this.$nextTick((function(){e.list=t}))}},created:function(){var t=this;this.scroll=window.innerHeight-290,this.listSearch(),this.searchApp&&Object(d["h"])({pubAppId:this.searchApp}).then((function(e){0===e.code&&(t.placementSelectOption=e.data,t.instanceSelectOption=e.data)}))},methods:{onCellChange:function(t,e,a){var n=this;if(t.priority!==a){var i,s=[],o=!1,l=Object(r["a"])(this.data);try{for(l.s();!(i=l.n()).done;){var d=i.value;d.id&&d.id!==t.id&&(d.priority===a&&(o=!0,s.push(t.id)),s.push(d.id))}}catch(p){l.e(p)}finally{l.f()}o||s.push(t.id),Object(c["s"])({placementRuleIds:s.join(","),placementId:{}}).then((function(t){0===t.code&&n.listSearch()}))}},tableChange:function(t,e,a){this.sortOrder=a.order},instanceStatusUpdate:function(t){var e=this,a=t.priority>0?0:1;1===a?Object(c["p"])({ruleId:t.ruleId,adnId:t.adnId,instanceId:t.instanceId}).then((function(t){0===t.code&&e.listSearch()})):Object(c["q"])({ruleId:t.ruleId,instanceId:t.instanceId}).then((function(a){0===a.code&&(t.priority=void 0,e.listSearch())}))},handleEdit:function(t){t?this.$router.push({name:"MediationEdit",params:{ruleId:t.id,pubAppId:this.searchApp,placementId:this.searchPlacement},query:{type:"Edit"}}):this.$router.push({name:"MediationEdit",params:{pubAppId:this.searchApp,placementId:this.searchPlacement},query:{type:"Add"}})},segmentDelete:function(t){var e=this;Object(c["x"])({ruleId:t.id}).then((function(t){0===t.code&&e.listSearch()}))},viewMediation:function(t){t&&this.$router.push({name:"MediationDetails",params:{ruleId:t.id,pubAppId:this.searchApp,placementId:this.searchPlacement},query:{type:"Details"}})},regoinsSelectedId:function(t){this.regions=t},handleOpen:function(t){if(t["expandStatus"]=!t["expandStatus"],this.currentExpandedStatOpen=!this.currentExpandedStatOpen,this.curExpandedRowKeys.length>0){var e=this.curExpandedRowKeys.indexOf(t.id);e>-1?this.curExpandedRowKeys.splice(e,1):this.curExpandedRowKeys.push(t.id)}else this.curExpandedRowKeys.push(t.id)},handelMediationRuleInstanceUpdate:function(t){var e=this;Object(c["o"])({status:0===t.status?1:0,id:t.id}).then((function(a){0===a.code?(Object.assign(t,{status:0===t.status?1:0}),e.$message.success("success")):e.$message.error(a.msg)}))},placementSave:function(){var t=this,e=this.form.validateFields;e((function(e,a){e||(a.id=t.searchPlacement,Object(d["l"])(a).then((function(e){0===e.code?t.$message.success("success"):t.$message.error("error")})))}))},callback:function(t){},listSearch:function(){var t=this;if(this.fetching=!0,!this.searchPlacement||"undefined"===this.searchPlacement)return this.fetching=!1,!1;var e={pubAppId:this.searchApp,placementId:this.searchPlacement},a=Object(s["a"])(this.regions);a&&Object.keys(a).length>0&&(a&&a.indexOf("ALL")>-1&&(a.splice(a.indexOf("ALL"),1),a.push("00")),e.countries=a.join(",")),Object(c["v"])(e).then((function(e){0===e.code&&(t.arraySort(e.data),t.data=e.data)})).finally((function(){t.fetching=!1})),Object(d["g"])({placementId:this.searchPlacement}).then((function(e){0===e.code&&t.$nextTick((function(){t.form.setFieldsValue(y()(e.data,["batchSize","preloadTimeout","inventoryCount"]))}))}))},resetSearch:function(){this.regions=[]},segmentStatusUpdate:function(t){var e=this,a=1===t.status?0:1;Object(c["y"])({id:t.id,status:a,pubAppId:this.searchApp,placementId:this.searchPlacement}).then((function(n){0===n.code?(t.status=a,e.listSearch(),e.$message.success("success")):e.$message.error("error")}))},placementFilterOption:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0||e.componentOptions.children[1].children[0].text.indexOf(t)>=0},selectPlacementChange:function(t){this.searchOption.placementId=t},instanceFilterOption:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0||e.componentOptions.children[1].children[0].text.indexOf(t)>=0},selectInstanceChange:function(t){this.searchOption.instanceId=t},arraySort:function(t){t=t.sort((function(t,e){return t.status===e.status?t.priority-e.priority:e.status-t.status}))}}},g=S,v=(a("39b0"),a("2877")),x=Object(v["a"])(g,n,i,!1,null,"02f4c0be",null);e["default"]=x.exports},"39b0":function(t,e,a){"use strict";var n=a("69d3"),i=a.n(n);i.a},"69d3":function(t,e,a){},cda8:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{style:t.status?null:"opacity: 0.3;"},[a("div",{staticStyle:{display:"inline-block"}},[a("div",{staticStyle:{color:"#333333","font-size":"14px","margin-bottom":"5px"}},[a("ellipsis",{attrs:{length:20,tooltip:""}},[t._v(t._s(t.name))])],1),a("div",{staticStyle:{color:"#999999","font-size":"12px"}},[0===t.type?a("span",[t._v("Banner")]):t._e(),1===t.type?a("span",[t._v("Native")]):t._e(),2===t.type?a("span",[t._v("Rewarded Video")]):t._e(),3===t.type?a("span",[t._v("Interstitial")]):t._e(),a("a-divider",{attrs:{type:"vertical"}}),a("span",{staticStyle:{"margin-left":"-2px"}},[t._v(t._s(t.id))])],1)])])},i=[],s=(a("a9e3"),a("2af9")),r={name:"OmPlacementInfo",props:{id:{type:Number,required:!1,default:0},name:{type:String,required:!0,default:""},type:{type:Number,required:!1,default:0},status:{type:Number,required:!1,default:1}},components:{Ellipsis:s["a"]},data:function(){return{visible:!0}}},c=r,o=a("2877"),l=Object(o["a"])(c,n,i,!1,null,"d97fb474",null);e["a"]=l.exports},d5d5:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-select",{staticClass:"plcament-select",staticStyle:{width:"256px",position:"absolute",right:"0","z-index":"100",top:"12px"},attrs:{dropdownMatchSelectWidth:!1,showArrow:!1,optionLabelProp:"title"},on:{change:t.handleChange},model:{value:t.selectePlc,callback:function(e){t.selectePlc=e},expression:"selectePlc"}},t._l(t.plcList,(function(t){return a("a-select-option",{key:t.id,attrs:{title:t.name}},[a("om-placement-info",{attrs:{type:t.adType,name:t.name,id:t.id}})],1)})),1)},i=[],s=(a("7db0"),a("2af9")),r=a("283f"),c=a("5880"),o=a("cda8"),l={name:"PlacementSelect",components:{Ellipsis:s["a"],OmPlacementInfo:o["a"]},data:function(){return{plcList:{},selectePlc:""}},methods:{handleChange:function(t,e){var a=this.plcList.find((function(e){return e.id===t}));a&&this.$store.commit("SET_PLACEMENT",a)},updateSelectList:function(t){if(t){var e=this,a=localStorage.getItem("searchPlacement");Object(r["k"])({pubAppId:t}).then((function(t){if(0===t.code&&t.data.length)if(e.plcList=t.data,a){var n=t.data.find((function(t){return t.id===parseInt(a)}));n?(e.selectePlc=parseInt(a),e.$store.commit("SET_PLACEMENT",n)):(e.selectePlc=e.plcList[0].id,e.$store.commit("SET_PLACEMENT",e.plcList[0]))}else e.selectePlc=e.plcList[0].id,e.$store.commit("SET_PLACEMENT",e.plcList[0])}))}}},created:function(){this.updateSelectList(this.searchApp)},computed:Object(c["mapState"])({searchApp:function(t){return t.publisher.searchApp},searchPlacement:function(t){return t.publisher.searchPlacement},searchPlacementName:function(t){return t.publisher.searchPlacementName},searchPlacementType:function(t){return t.publisher.searchPlacementType}}),watch:{searchApp:function(t){this.updateSelectList(t)}}},d=l,p=a("2877"),u=Object(p["a"])(d,n,i,!1,null,null,null);e["a"]=u.exports}}]);