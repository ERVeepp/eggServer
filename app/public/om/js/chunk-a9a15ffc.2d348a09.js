(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a9a15ffc"],{"34de":function(t,a,e){"use strict";e.r(a);var o=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticStyle:{"margin-top":"8px"}},[e("a-spin",{attrs:{spinning:t.headLoading}},[e("div",{staticClass:"head-revenue-row"},t._l(t.headRevenueData,(function(a,o){return e("div",{key:o,staticClass:"head-revenue-col"},[e("div",{staticClass:"revenue"},[t._v(t._s(a))]),e("div",{staticClass:"range"},[t._v(t._s(o))])])})),0)]),e("div",{staticClass:"ds-middle"},[e("om-chart-line",{staticClass:"left",staticStyle:{border:"none"},attrs:{data:t.middleLineData,height:350,legend:{offsetY:16,marker:"circle"},padding:"auto",xTickCount:7,"x-column":"day","y-column":"cost","y-format":"$0,0","group-by":"country"}}),e("om-chart-ring",{staticClass:"right",attrs:{title:"Revenue by Regions",data:t.middlePieData,height:350,"x-column":"country","y-column":"cost","y-format":"$0,0"}})],1),e("div",{staticClass:"ds-bottom"},[e("a-select",{staticStyle:{"margin-bottom":"16px"},attrs:{value:t.bottom.dateRange},on:{change:t.handleRangeChange}},[e("a-select-option",{key:14},[t._v("Last 7 days vs Previous 7 days")]),e("a-select-option",{key:56},[t._v("Last 28 days vs Previous 28 days")])],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{span:12}},[e("a-spin",{staticClass:"ds-bottom-card",attrs:{spinning:t.bottom.loading}},[e("div",{staticClass:"title"},[t._v("Performance")]),e("a-row",{attrs:{gutter:32}},[e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"Revenue","y-column":"cost","y-format":"$0,0.00a"}})],1),e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"Requests","y-column":"request"}})],1)],1),e("a-row",{attrs:{gutter:32}},[e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"Impressions","y-column":"impr"}})],1),e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"Fill Rate","y-column":"fillRate","y-format":"0,0.00a%"}})],1)],1),e("a-row",{attrs:{gutter:32}},[e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"eCPM","y-column":"ecpm","y-format":"$0.00a"}})],1),e("a-col",{attrs:{span:12}})],1)],1)],1),e("a-col",{attrs:{span:12}},[e("a-spin",{staticClass:"ds-bottom-card",attrs:{spinning:t.bottom.loading}},[e("div",{staticClass:"title"},[t._v("User Activity")]),e("a-row",{attrs:{gutter:32}},[e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"DAU","y-column":"dau"}})],1),e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"ARPDAU","y-column":"arpDau","y-format":"$0.000"}})],1)],1),e("a-row",{attrs:{gutter:32}},[e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"DEU","y-column":"deu"}})],1),e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"ARPDEU","y-column":"arpDeu","y-format":"$0.000"}})],1)],1),e("a-row",{attrs:{gutter:32}},[e("a-col",{attrs:{span:12}},[e("om-ds-bottom-chart",{attrs:{data:t.bottom.chartData,sum:t.bottom.sumData,title:"Engagement Rate","y-column":"engagementRate","y-format":"0,0.00%"}})],1),e("a-col",{attrs:{span:12}})],1)],1)],1)],1)],1)],1)},r=[],i=(e("4de4"),e("4160"),e("d81d"),e("b64b"),e("d3b7"),e("159b"),e("5530")),n=e("b85c"),s=e("c1df"),c=e.n(s),u=e("c8c3"),l=e("1c31"),d=e("dda2"),h=(e("99af"),e("a9e3"),e("99afe")),m=e("7e03"),p=e("43e2");m["a"].register("currency",p["a"]);var g={name:"OmChartPie",props:{title:String,loading:{type:Boolean,default:!1},height:{type:Number,required:!1},data:{type:Array,required:!0},xColumn:{type:[String,Function],default:"day"},yColumn:{type:[String,Function],required:!0},yAlias:String,yFormat:{type:String,default:"0,0.00a"}},data:function(){return{chart:null}},watch:{data:function(){this.buildChart()}},render:function(t){return t("a-spin",{style:{borderRadius:"4px"},props:{spinning:this.loading}},[t("div",{class:"g2chart"})])},destroyed:function(){this.chart.destroy(),this.chart=null},methods:{getColumnValue:function(t,a){return void 0===a?void 0:a instanceof Function?a.call(t,t):t[a]},buildChartData:function(t,a,e){var o=this,r={},i=0,n=t.map((function(t){var n=o.getColumnValue(t,a),s=o.getColumnValue(t,e);return r[n]=s,i+=s,{x:n,y:s}})).sort((function(t,a){var e=t.x.length-a.x.length;return 0===e?a.y-t.y:e}));return{list:n,map:r,total:i}},buildChart:function(){var t=this.buildChartData(this.data,this.xColumn,this.yColumn),a=t.list,e=t.map,o=t.total;if(this.chart)this.chart.changeData(a),this.chart.repaint();else{var r={visible:!1},i={data:a,title:{text:this.title,visible:!0,style:{color:"#333333",fontWeight:"bold"}},forceFit:!0,radius:1,innerRadius:.4,colorField:"x",angleField:"y",legend:r,label:{type:"inner",formatter:function(t,a){return"".concat(a._origin.x,": ").concat(Object(m["a"])(a._origin.y,"$0,0a"))}},tooltip:{htmlContent:function(t){return"<div>".concat(t," ").concat(Object(m["a"])(e[t]/o,"0.0%"),"</div>")}},statistic:[r]};this.height>0&&(i.height=this.height),this.chart=new h["b"](this.$el.querySelector(".g2chart"),i),this.chart.render()}}}},f=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"bc",style:{height:t.height}},[e("div",{staticClass:"bc-left"},[e("div",{staticClass:"bc-title"},[t._v(t._s(t.title))]),e("div",{staticClass:"bc-value"},[t._v(t._s(t.value))]),e("div",{class:["bc-compare",t.upDown]},[e("span",[t._v(t._s(t.growthValue))]),e("span",{staticStyle:{"margin-left":"6px"}},[t._v("("+t._s(t.growthRate)+")")])])]),e("div",{staticClass:"bc-right"},[e("div",{staticClass:"g2chart",style:{height:t.height}})])])},b=[],y=e("3835"),v=e("a020");m["a"].register("currency",p["a"]),m["a"].register("percent",v["a"]);var D={name:"OmDashboardBottomChart",props:{title:{type:String,required:!0},data:{type:Array,required:!0},sum:{type:Object,required:!0},yColumn:{type:[String,Function],required:!0},yFormat:{type:String,default:"0,0.00a"}},data:function(){return{chart:null,height:80,value:"",growthValue:0,growthRate:0,upDown:""}},watch:{data:function(t,a){this.buildChart()},sum:function(){this.calcValue()}},mounted:function(){this.calcValue(),this.buildChart()},destroyed:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{numerify:m["a"],calcValue:function(){var t=this.sum[this.yColumn];if(t&&!(t.length<2)){var a=Object(y["a"])(t,2),e=a[0],o=a[1],r=e-o;this.upDown=r<0?"down":"up",this.value=Object(m["a"])(e,this.yFormat),this.growthValue=Object(m["a"])(r,this.yFormat),this.growthRate=Object(m["a"])(e/(o||1)-1,"+0,0.00a%")}},getColumnValue:function(t,a){return void 0===a?void 0:a instanceof Function?a.call(t,t):t[a]},buildChartData:function(t,a,e,o){var r=this;return t.map((function(t){var i=r.getColumnValue(t,a),n=r.getColumnValue(t,e),s=r.getColumnValue(t,o);return{x:i,g:n,y:s}}))},buildChart:function(){if(this.data){var t=this.buildChartData(this.data,"x","g",this.yColumn);if(this.chart)this.chart.changeData(t),this.chart.repaint();else{var a={visible:!1},e={data:t,forceFit:!0,smooth:!0,height:this.height,padding:[0,0,8,0],tooltip:a,legend:a,xAxis:{line:a,tickLine:a,label:a},yAxis:{grid:a,label:a},xField:"x",yField:"y",seriesField:"g",color:["#C7E7FF","#3DADFF"]};this.chart=new h["a"](this.$el.querySelector(".g2chart"),e),this.chart.render()}}}}},C=D,R=(e("3dab"),e("2877")),w=Object(R["a"])(C,f,b,!1,null,"1ead1e24",null),O=w.exports,x=e("5880");m["a"].register("currency",p["a"]);var A={name:"OmAppDashboard",components:{PageView:u["a"],OmChartLine:d["a"],OmChartRing:g,OmDsBottomChart:O},data:function(){var t=["cost","request","filled","impr","dau","deu"];return{headLoading:!1,middleLoading:!1,headRevenueData:{},middleLineData:[],middlePieData:[],bottom:{loading:!1,dateRange:14,chartData:[],sumData:{},metrics:t}}},computed:Object(x["mapState"])({pubAppId:function(t){return"/overview/dashboard"===this.$route.path?0:t.publisher.searchApp}}),created:function(){this.reloadAllData()},beforeRouteUpdate:function(t,a,e){this.reloadAllData(),e()},methods:{handleRangeChange:function(t){this.bottom.dateRange=t,this.loadBottomData()},reloadAllData:function(){this.loadHeadData(),this.loadMiddleData(),this.loadBottomData()},loadHeadData:function(){var t=this;this.middleLoading=!0;var a={};this.pubAppId>0&&(a.pubAppId=this.pubAppId),Object(l["b"])(a).then((function(a){if(!a.code){var e=a.data,o=e.yesterdayRevenue,r=e.lastSevenDayRevenue,i=e.currentMonthRevenue,n=e.lastMonthRevenue,s="$0,0";t.headRevenueData={Yesterday:Object(m["a"])(o,s),"Last 7 days":Object(m["a"])(r,s),"This month so far":Object(m["a"])(i,s),"Last month":Object(m["a"])(n,s)}}})).finally((function(a){t.middleLoading=!1}))},loadMiddleData:function(){var t=this;this.headLoading=!0;var a={};this.pubAppId>0&&(a.pubAppId=this.pubAppId),Object(l["c"])(a).then((function(a){if(!a.code){var e=[],o={};a.data.forEach((function(t){"OTHER"!==t.country&&e.push(t),void 0===o[t.country]?o[t.country]=t.cost:o[t.country]+=t.cost})),t.middleLineData=e,t.middlePieData=Object.keys(o).map((function(t){return{country:t,cost:o[t]}}))}})).finally((function(a){t.headLoading=!1}))},loadBottomData:function(){for(var t=this,a="YYYY-MM-DD",e=c()().utc().add(1,"d"),o={},r=0;r<2;r++)for(var s=String(r),u=this.bottom.dateRange/2;u>0;--u)o[e.add(-1,"d").format(a)]={x:u,g:s};var d={};d.dateBegin=c()().utc().add(-this.bottom.dateRange,"d").format(a),d.dateEnd=c()().utc().format(a),d.type=["lr","api","dau"],d.dimension=["day"],this.pubAppId>0&&(d.pubAppId=[this.pubAppId]),this.bottom.loading=!0,Object(l["e"])(d).then((function(a){if(!(a.code>0)){var e,r={fillRate:0,ecpm:0,arpDau:0,arpDeu:0,engagementRate:0},s={},c=Object(n["a"])(t.bottom.metrics);try{for(c.s();!(e=c.n()).done;){var u=e.value;s[u]=[0,0],r[u]=0}}catch(y){c.e(y)}finally{c.f()}for(var l=Object(i["a"])({},o),d=a.data.map((function(a){var e=o[a.day];if(!e)return null;delete l[a.day];var r=e.x,i=e.g;a.x=r,a.g=i,a.impr=a.apiImpr,a.request=a.waterfallRequest,a.filled=a.waterfallFilled,a.fillRate=a.ecpm=a.arpDau=a.arpDeu=a.engagementRate=0,a.request>0&&(a.fillRate=a.filled/a.request),a.impr>0&&(a.ecpm=1e3*a.cost/a.impr),a.dau>0&&(a.arpDau=a.cost/a.dau,a.engagementRate=a.deu/a.dau),a.deu>0&&(a.arpDeu=a.cost/a.deu);var c,u=Object(n["a"])(t.bottom.metrics);try{for(u.s();!(c=u.n()).done;){var d=c.value;isNaN(a[d])||(s[d][i]+=a[d])}}catch(y){u.e(y)}finally{u.f()}return a})).filter((function(t){return!!t})),h=0,m=Object.keys(l);h<m.length;h++){var p=m[h],g=o[p],f=g.x,b=g.g;d.push(Object(i["a"])({x:f,g:b},r))}s.fillRate=[s.filled[0]/s.request[0],s.filled[1]/s.request[1]],s.ecpm=[1e3*s.cost[0]/s.impr[0],1e3*s.cost[1]/s.impr[1]],s.arpDau=[s.cost[0]/s.dau[0],s.cost[1]/s.dau[1]],s.arpDeu=[s.cost[0]/s.deu[0],s.cost[1]/s.deu[1]],s.engagementRate=[s.deu[0]/s.dau[0],s.deu[1]/s.dau[1]],t.bottom.chartData=d.sort((function(t,a){return a.g-t.g})),t.bottom.sumData=s}})).finally((function(a){t.bottom.loading=!1}))}}},j=A,_=(e("38ca"),Object(R["a"])(j,o,r,!1,null,"018f244a",null));a["default"]=_.exports},"38ca":function(t,a,e){"use strict";var o=e("ee34"),r=e.n(o);r.a},"3dab":function(t,a,e){"use strict";var o=e("c8f7"),r=e.n(o);r.a},c8f7:function(t,a,e){},ee34:function(t,a,e){}}]);